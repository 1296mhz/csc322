extends layout

block content
  .pagination.pagination-centered
    ul
      li
        a(href='#') A
      li
        a(href='#') B
      li
        a(href='#') C
      li
        a(href='#') D
      li
        a(href='#') E
      li
        a(href='#') F
      li
        a(href='#') G
      li
        a(href='#') H
      li
        a(href='#') I
      li
        a(href='#') J
      li
        a(href='#') K
      li
        a(href='#') L
      li.active
        a(href='#') M
      li
        a(href='#') N
      li
        a(href='#') O
      li
        a(href='#') P
      li
        a(href='#') Q
      li
        a(href='#') R
      li
        a(href='#') S
      li
        a(href='#') T
      li
        a(href='#') U
      li
        a(href='#') V
      li
        a(href='#') W
      li
        a(href='#') X
      li
        a(href='#') Y
      li
        a(href='#') Z
  table.table
        tbody
          for game in games
            .modal.hide.fade(id='modal-#{game.slug}', tabindex='-1', role='dialog', aria-labelledby='myModalLabel', aria-hidden='true')
              .modal-header
                span.lead Game Checkout
                  img.pull-right(src='/img/new_visa_medium.gif')
              .modal-body
                label
                  i.icon-user
                  |  Name on Card
                input.input-medium(type='text')
                label
                  i.icon-barcode
                  |  Card Number
                input.input-medium(type='text', placeholder='•••• •••• •••• ••••', maxlength=16)

                label
                  i.icon-time
                  |  Expiration Date
                input.input-mini(type='text', placeholder='MMYY', maxlength=4)
                label
                  i.icon-qrcode
                  |  Card Code
                input.input-mini(type='text', placeholder='CVC', maxlength=4)
              .modal-footer
                button.btn(data-dismiss='modal', aria-hidden='true') Cancel
                button.btn.btn-primary(id='#{game.slug}') Buy
            tr
              td.span2
                img.img-polaroid(src=game.thumbnail)
              td
                a(href='/games/#{game.slug}')
                  strong
                    = game.title
                button.btn.btn-primary.btn-mini(id='price-#{game.slug}', href='#modal-#{game.slug}', role='button', data-toggle='modal')
                  i.icon-shopping-cart.icon-white
                  =  game.price
                if user.purchasedGames.length > 0
                  for mygame in user.purchasedGames
                    if mygame.slug == game.slug
                      script(type='text/javascript')
                        $('#price-#{game.slug}').removeAttr('href');
                        $('#price-#{game.slug}').html('<i class="icon-shopping-cart icon-white"></i> Purchased');
                div
                  span(id='_' + game.slug)
                  span(id='votes', name='votes')
                  |  (#{game.votes} votes)
                div
                  small.muted
                    div #{game.releaseDate} | #{game.publisher}
                    div #{game.genre}
                p
                  =game.description
            if typeof(user.userName) != 'undefined'
              for voter in game.votedPeople
                if voter == user.userName
                  script(type='text/javascript')
                    $('#_#{game.slug}').raty({
                      round : { down: .25, full: .6, up: .76 },
                      score: #{game.rating}/#{game.votes},
                      readOnly: true
                    });
                else
                  script(type='text/javascript')
                    $('#_#{game.slug}').raty({
                      round : { down: .25, full: .6, up: .76 },
                      score: #{game.rating}/#{game.votes},
                      readOnly: false,
                      click: function (score, event) {
                        var self = this;
                        $.meow({
                          message: 'Thanks for voting. Your rating has been recorded.',
                          icon: 'http://png-3.findicons.com/files/icons/1577/danish_royalty_free/32/smiley.png'
                        });
                        $.ajax({
                          type: 'POST',
                          url: '/games/rating',
                          data: {
                            slug: $(self).attr('id').slice(1),
                            rating: score
                          },
                          success: function () {
                            console.log('setting to read-only');
                            $(self).raty('readOnly', true);
                          }
                        });
                      }
                    });
            else
              script(type='text/javascript')
                $('#_#{game.slug}').raty({
                  round : { down: .25, full: .6, up: .76 },
                  score: #{game.rating}/#{game.votes},
                  readOnly: true
                });

            script(type='text/javascript')
              $('##{game.slug}').click(function() {
                var game = this;
                $.ajax({
                  type: 'post',
                  url: '/buy',
                  data:  {
                    slug: $(game).attr('id')
                  }
                }).success(function () {
                  $('#price-#{game.slug}').attr('disabled', 'true');
                  $('#modal-' + $(game).attr('id')).modal('hide');
                  humane.log('Your order has been submitted!');
                });
              });